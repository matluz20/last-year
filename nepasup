<?php

// Démarrage de la session
session_start();

    // Vérification de la variable de session "connecter"
    if(@$_SESSION["connecter"]!="oui"){ 
        // Redirection vers la page d'accueil si l'utilisateur n'est pas connecté
        header ('Location: /');
        // Arrêt de l'exécution du code
        exit();
    } 

    // Inclusion du fichier de connexion à la base de données
    require_once('bdd/connexion_bdd.php');

        // Récupération du nom de l'utilisateur à partir de la variable de session
        $nom_user = @$_SESSION["username"];

        // Requête SQL pour récupérer les informations de l'utilisateur
        $sql1 = "SELECT * FROM `Utilisateur` WHERE username = '$nom_user'";
        $resultat1 = $conn->query($sql1);
        $row = $resultat1->fetch_assoc();



        // Initialisation des variables d'affichage des sections
        $afficher_section1 = false;
        $afficher_section2 = false;

        // Vérification du statut de l'utilisateur
        if($row["statut"] == "acheteur"){
            // Affichage de la section 1 si l'utilisateur est un acheteur
            $afficher_section1 = true;
        }
        else{
            // Affichage de la section 2 si l'utilisateur n'est pas un acheteur
            $afficher_section2 = true;
        }


?>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/devenirvendeur.css">
    <title>Vendez votre article</title>
</head>

<body >


            <!-- Affichage de la section 1 si l'utilisateur n'est pas un vendeur -->
            <?php if($afficher_section1): ?>

                <div id="section1">
                    <p>Votre compte ne vous permet pas d'effectuer les ventes. <br> Pour devenir vendeur vous devez faire la demande en cliquant sur le boutton dessus</p>
                    
                        <form method="post" action="<?php echo htmlspecialchars($_SERVER["PHP_SELF"]); ?>">
                            <input type="submit" name="envoi" value="Envoyer la demande">
                        </form>

                </div>

            <?php endif; ?>


                <!-- Affichage de la section 2 si l'utilisateur est un vendeur -->
                <?php if($afficher_section2): ?>
                    <div id="section2">

                    <header>
                        <div class="h1">
                            <h1><a href="/">Efrei MarketPlace</a></h1>
                            <h1 class="account"><a href="/php/compte/moncompte.php"><img src="/image/person.svg" class="accountsvg"></a></h1>
                        </div>
                        <nav class="navbar">                            
                            <ul class="menu">
                            <li><a href="/php/afterconexion.php">Tout Parcourir</a></li>
                            <li><a href="/php/compte/notification.php">Notifications</a></li>
                            <li><a href="/php/paiement.php">Panier

                            <?php 

            // Démarrage de la session
            session_start();

            // Vérification de la variable de session "connecter"
            if(@$_SESSION["connecter"]!="oui"){ 
                // Redirection vers la page d'accueil si l'utilisateur n'est pas connecté
                header ('Location: /');
                // Arrêt de l'exécution du code
                exit();
            } 

            require_once('bdd/connexion_bdd.php');
            $nom_user = @$_SESSION["username"];
            
            $sql1 = "SELECT COUNT(*) as total FROM `Panier` WHERE username = '$nom_user'";
            $resultat1 = $conn->query($sql1);

            if ($resultat1) {
                $row = $resultat1->fetch_assoc();
                $nombreLignes = $row['total'];
                echo $nombreLignes;
            } else {
                echo "1";
            }

            ?>  


                </a></li>
                <li><a href="/php/compte/deconnexion.php">Deconnexion</a></li>
                </ul>
            </nav>
        </header>



       <div class="depot_articles">
            <h3>Déposer votre article ici </h3>
            <button id="modal-btn">Déposer</button>

        </div>
        

        <div id="modal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h3>Saisisez ci-dessous les informations concernant votre article :</h3><br>

                <form action="/php/articles/depot/traitement.php" method="post" enctype="multipart/form-data">
                    <label for="titre">Titre :</label><br>
                    <input type="text" id="titre" name="titre" required><br>

                    <label for="description">Description :</label><br>
                    <textarea id="description" name="description" required></textarea><br>

                    <label for="prix">Prix :</label><br>
                    <input type="number" id="prix" name="prix" required><br>

                    <label for="photo">Photo :</label><br>
                    <input type="file" name="image" id="image" accept="image/*" required><br>

                    <label for="categorie">Catégorie :</label><br>
                    <select name="categorie" id="categorieArticle" required>
                        <option value="vetement">Vêtement</option>
                        <option value="informatique">Matériel informatique</option>
                        <option value="electromenager">Appareils électroménagers</option>
                        <option value="vehicule">Véhicule</option>
                        <option value="fitness">Appareils de fitness</option>
                        <option value="jeuxvideo">Jeux-vidéos</option>
                        <option value="console">Console de jeu</option>
                        <option value="autres">Autres</option>
                    </select><br>

                    <input type="submit" value="Envoyer">
                </form>


            </div>
        </div>

        <script>

                                // Récupérer la référence de la fenêtre modale
                var modal = document.getElementById("modal");

                // Récupérer la référence de l'élément qui ouvre la fenêtre modale
                var modalTrigger = document.getElementById("modal-btn");

                // Récupérer la référence de l'élément pour fermer la fenêtre modale
                var closeBtn = document.getElementsByClassName("close")[0];

                // Fonction pour ouvrir la fenêtre modale
                function openModal() {
                modal.style.display = "block";
                }

                // Fonction pour fermer la fenêtre modale
                function closeModal() {
                modal.style.display = "none";
                }

                // Écouter l'événement clic pour ouvrir la fenêtre modale
                modalTrigger.addEventListener("click", openModal);

                // Écouter l'événement clic pour fermer la fenêtre modale en cliquant sur le bouton de fermeture
                closeBtn.addEventListener("click", closeModal);



        </script>


        <!-- <form action="articles/depot/traitement.php" method="post" enctype="multipart/form-data">
            <input type="file" name="image" id="image">
            <input type="submit" value="Upload">
        </form> -->
        
        </div>
        <footer>
  <div class="footer-container">
    <div class="name-group">
      <a href="https://www.linkedin.com/in/toufik-laouamen-27808a203/" target="_blank">LAOUAMEN Toufik</a>
      <a href="https://www.linkedin.com/in/smrohman/" target="_blank">ROHMAN Majed</a>
    </div>
    <div class="name-group">
      <a href="https://www.linkedin.com/in/matondo-luzolo-6a40891b2/" target="_blank">LUZOLO Matondo</a>
      <a href="https://www.linkedin.com/in/moctar-sahande/" target="_blank">SAHANDE Mohamed</a>
    </div>
  </div>
  <div class="photo-container">
    <img src="/image/LOGO PROJECT.png" alt="Photo" class="footer-photo">
  </div>
  <p>&copy; Efrei MarketPlace - Tous droits réservés</p>
</footer> 
      
        
    <?php endif; ?>
    
   
</body>
</html>




<?php

require_once('bdd/connexion_bdd.php');



if(isset($_POST['envoi'])){

    session_start(); 

    $nom_user = @$_SESSION["username"];

    $sql1 = "SELECT * FROM `devenirvendeur` WHERE Nom = '$nom_user'";
    $resultat1 = $conn->query($sql1);

    // Vérification si la requête s'est bien exécutée
    if ($resultat1->num_rows > 0) {
        echo '<script type="text/javascript">'; 
        echo 'alert("Vous avez déjà effectué une demande ! veillez attendre notre reponse ! ");';  
        echo 'window.location.href = "afterconexion.php"'; // redirection vers la page après connexion 
        echo '</script>';
    }


    if ($resultat1->num_rows == 0) {
    
    $sql = "INSERT INTO `devenirvendeur` ( `Nom`)
    VALUES( '$nom_user')";
    
    $resultat = $conn->query($sql);
    
    echo '<script type="text/javascript">'; 
    echo 'alert("Votre démande a bien été pris en compte ! nous vous tiendrons informé ");';  
    echo 'window.location.href = "afterconexion.php"'; // redirection vers la page après connexion 
    echo '</script>';
    }
    



}




?>


